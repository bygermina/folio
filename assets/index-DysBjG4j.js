import{r as d,j as h,f as B,h as ce,R as G,k as le,c as de,e as ue,g as fe,T as Z}from"./index-BlVSbGVW.js";const he="_card_1p13l_14",me={card:he},ne=d.forwardRef(({children:e,className:t,as:s="div",...n},i)=>h.jsx(s,{ref:i,className:B(me.card,t),...n,children:e}));ne.displayName="Card";const L=typeof window<"u"?d.useLayoutEffect:d.useEffect;function Q(e){if(e!==void 0)switch(typeof e){case"number":return e;case"string":{if(e.endsWith("px"))return parseFloat(e);break}}}function ge({box:e,defaultHeight:t,defaultWidth:s,disabled:n,element:i,mode:r,style:l}){const{styleHeight:a,styleWidth:o}=d.useMemo(()=>({styleHeight:Q(l?.height),styleWidth:Q(l?.width)}),[l?.height,l?.width]),[c,f]=d.useState({height:t,width:s}),u=n||a!==void 0||r==="only-width"||a!==void 0&&o!==void 0;return L(()=>{if(i===null||u)return;const p=new ResizeObserver(x=>{for(const y of x){const{contentRect:S,target:g}=y;i===g&&f(I=>I.height===S.height&&I.width===S.width?I:{height:S.height,width:S.width})}});return p.observe(i,{box:e}),()=>{p?.unobserve(i)}},[e,u,i,a,o]),d.useMemo(()=>({height:a??c.height,width:o??c.width}),[c,a,o])}function we(e){const t=d.useRef(()=>{throw new Error("Cannot call during render.")});return L(()=>{t.current=e},[e]),d.useCallback(s=>t.current?.(s),[t])}function J({containerElement:e,direction:t,isRtl:s,scrollOffset:n}){return n}function j(e,t="Assertion error"){if(!e)throw console.error(t),Error(t)}function D(e,t){if(e===t)return!0;if(!!e!=!!t||(j(e!==void 0),j(t!==void 0),Object.keys(e).length!==Object.keys(t).length))return!1;for(const s in e)if(!Object.is(t[s],e[s]))return!1;return!0}function se({cachedBounds:e,itemCount:t,itemSize:s}){if(t===0)return 0;if(typeof s=="number")return t*s;{const n=e.get(e.size===0?0:e.size-1);j(n!==void 0,"Unexpected bounds cache miss");const i=(n.scrollOffset+n.size)/e.size;return t*i}}function be({align:e,cachedBounds:t,index:s,itemCount:n,itemSize:i,containerScrollOffset:r,containerSize:l}){if(s<0||s>=n)throw RangeError(`Invalid index specified: ${s}`,{cause:`Index ${s} is not within the range of 0 - ${n-1}`});const a=se({cachedBounds:t,itemCount:n,itemSize:i}),o=t.get(s),c=Math.max(0,Math.min(a-l,o.scrollOffset)),f=Math.max(0,o.scrollOffset-l+o.size);switch(e==="smart"&&(r>=f&&r<=c?e="auto":e="center"),e){case"start":return c;case"end":return f;case"center":return o.scrollOffset<=l/2?0:o.scrollOffset+o.size/2>=a-l/2?a-l:o.scrollOffset+o.size/2-l/2;case"auto":default:return r>=f&&r<=c?r:r<f?f:c}}function X({cachedBounds:e,containerScrollOffset:t,containerSize:s,itemCount:n,overscanCount:i}){const r=n-1;let l=0,a=-1,o=0,c=-1,f=0;for(;f<r;){const u=e.get(f);if(u.scrollOffset+u.size>t)break;f++}for(l=f,o=Math.max(0,l-i);f<r;){const u=e.get(f);if(u.scrollOffset+u.size>=t+s)break;f++}return a=Math.min(r,f),c=Math.min(n-1,a+i),l<0&&(l=0,a=-1,o=0,c=-1),{startIndexVisible:l,stopIndexVisible:a,startIndexOverscan:o,stopIndexOverscan:c}}function pe({itemCount:e,itemProps:t,itemSize:s}){const n=new Map;return{get(i){for(j(i<e,`Invalid index ${i}`);n.size-1<i;){const l=n.size;let a;switch(typeof s){case"function":{a=s(l,t);break}case"number":{a=s;break}}if(l===0)n.set(l,{size:a,scrollOffset:0});else{const o=n.get(l-1);j(o!==void 0,`Unexpected bounds cache miss for index ${i}`),n.set(l,{scrollOffset:o.scrollOffset+o.size,size:a})}}const r=n.get(i);return j(r!==void 0,`Unexpected bounds cache miss for index ${i}`),r},set(i,r){n.set(i,r)},get size(){return n.size}}}function ve({itemCount:e,itemProps:t,itemSize:s}){return d.useMemo(()=>pe({itemCount:e,itemProps:t,itemSize:s}),[e,t,s])}function xe({containerSize:e,itemSize:t}){let s;switch(typeof t){case"string":{j(t.endsWith("%"),`Invalid item size: "${t}"; string values must be percentages (e.g. "100%")`),j(e!==void 0,"Container size must be defined if a percentage item size is specified"),s=e*parseInt(t)/100;break}default:{s=t;break}}return s}function Ie({containerElement:e,containerStyle:t,defaultContainerSize:s=0,direction:n,isRtl:i=!1,itemCount:r,itemProps:l,itemSize:a,onResize:o,overscanCount:c}){const[f,u]=d.useState({startIndexVisible:0,startIndexOverscan:0,stopIndexVisible:-1,stopIndexOverscan:-1}),{startIndexVisible:p,startIndexOverscan:x,stopIndexVisible:y,stopIndexOverscan:S}={startIndexVisible:Math.min(r-1,f.startIndexVisible),startIndexOverscan:Math.min(r-1,f.startIndexOverscan),stopIndexVisible:Math.min(r-1,f.stopIndexVisible),stopIndexOverscan:Math.min(r-1,f.stopIndexOverscan)},{height:g=s,width:I=s}=ge({defaultHeight:s,defaultWidth:void 0,element:e,mode:"only-height",style:t}),O=d.useRef({height:0,width:0}),R=g,k=xe({containerSize:R,itemSize:a});d.useLayoutEffect(()=>{if(typeof o=="function"){const m=O.current;(m.height!==g||m.width!==I)&&(o({height:g,width:I},{...m}),m.height=g,m.width=I)}},[g,o,I]);const v=ve({itemCount:r,itemProps:l,itemSize:k}),Y=d.useCallback(m=>v.get(m),[v]),z=d.useCallback(()=>se({cachedBounds:v,itemCount:r,itemSize:k}),[v,r,k]),T=d.useCallback(m=>{const _=J({containerElement:e,direction:n,isRtl:i,scrollOffset:m});return X({cachedBounds:v,containerScrollOffset:_,containerSize:R,itemCount:r,overscanCount:c})},[v,e,R,n,i,r,c]);L(()=>{const m=e?.scrollTop??0;u(T(m))},[e,n,T]),L(()=>{if(!e)return;const m=()=>{u(_=>{const{scrollLeft:F,scrollTop:b}=e,w=J({containerElement:e,direction:n,isRtl:i,scrollOffset:b}),C=X({cachedBounds:v,containerScrollOffset:w,containerSize:R,itemCount:r,overscanCount:c});return D(C,_)?_:C})};return e.addEventListener("scroll",m),()=>{e.removeEventListener("scroll",m)}},[v,e,R,n,r,c]);const E=we(({align:m="auto",containerScrollOffset:_,index:F})=>{let b=be({align:m,cachedBounds:v,containerScrollOffset:_,containerSize:R,index:F,itemCount:r,itemSize:k});if(e){if(b=J({containerElement:e,direction:n,isRtl:i,scrollOffset:b}),typeof e.scrollTo!="function"){const w=T(b);D(f,w)||u(w)}return b}});return{getCellBounds:Y,getEstimatedSize:z,scrollToIndex:E,startIndexOverscan:x,startIndexVisible:p,stopIndexOverscan:S,stopIndexVisible:y}}function ye(e){return d.useMemo(()=>e,Object.values(e))}function Se(e,t){const{ariaAttributes:s,style:n,...i}=e,{ariaAttributes:r,style:l,...a}=t;return D(s,r)&&D(n,l)&&D(i,a)}function ze(e){return e!=null&&typeof e=="object"&&"getAverageRowHeight"in e&&typeof e.getAverageRowHeight=="function"}const Ce="data-react-window-index";function Oe({children:e,className:t,defaultHeight:s=0,listRef:n,onResize:i,onRowsRendered:r,overscanCount:l=3,rowComponent:a,rowCount:o,rowHeight:c,rowProps:f,tagName:u="div",style:p,...x}){const y=ye(f),S=d.useMemo(()=>d.memo(a,Se),[a]),[g,I]=d.useState(null),O=ze(c),R=d.useMemo(()=>O?b=>c.getRowHeight(b)??c.getAverageRowHeight():c,[O,c]),{getCellBounds:k,getEstimatedSize:v,scrollToIndex:Y,startIndexOverscan:z,startIndexVisible:T,stopIndexOverscan:E,stopIndexVisible:m}=Ie({containerElement:g,containerStyle:p,defaultContainerSize:s,direction:"vertical",itemCount:o,itemProps:y,itemSize:R,onResize:i,overscanCount:l});d.useImperativeHandle(n,()=>({get element(){return g},scrollToRow({align:b="auto",behavior:w="auto",index:C}){const K=Y({align:b,containerScrollOffset:g?.scrollTop??0,index:C});typeof g?.scrollTo=="function"&&g.scrollTo({behavior:w,top:K})}}),[g,Y]),L(()=>{if(!g)return;const b=Array.from(g.children).filter((w,C)=>{if(w.hasAttribute("aria-hidden"))return!1;const K=`${z+C}`;return w.setAttribute(Ce,K),!0});if(O)return c.observeRowElements(b)},[g,O,c,z,E]),d.useEffect(()=>{z>=0&&E>=0&&r&&r({startIndex:T,stopIndex:m},{startIndex:z,stopIndex:E})},[r,z,T,E,m]);const _=d.useMemo(()=>{const b=[];if(o>0)for(let w=z;w<=E;w++){const C=k(w);b.push(d.createElement(S,{...y,ariaAttributes:{"aria-posinset":w+1,"aria-setsize":o,role:"listitem"},key:w,index:w,style:{position:"absolute",left:0,transform:`translateY(${C.scrollOffset}px)`,height:O?void 0:C.size,width:"100%"}}))}return b},[S,k,O,o,y,z,E]),F=h.jsx("div",{"aria-hidden":!0,style:{height:v(),width:"100%",zIndex:-1}});return d.createElement(u,{role:"list",...x,className:t,ref:I,style:{position:"relative",maxHeight:"100%",flexGrow:1,overflowY:"auto",...p}},_,e,F)}const Re="_virtualizedTable_p8hv0_14",Ee={virtualizedTable:Re},_e=({rowCount:e,rowComponent:t,rowHeight:s=48,height:n=600,className:i="",onVisibleRowsChange:r,overscanCount:l=20})=>{const a=o=>h.jsx(t,{...o});return h.jsx("div",{className:B(Ee.virtualizedTable,i),style:{height:n},children:h.jsx(Oe,{rowComponent:a,rowCount:e,rowHeight:s,rowProps:{},overscanCount:l,onRowsRendered:({startIndex:o,stopIndex:c})=>{r&&r(o,c)},role:"presentation",style:{width:"100%",height:n}})})},ie=(e,t)=>e.position===t.position&&e.top===t.top&&e.left===t.left&&e.width===t.width&&e.height===t.height,je=()=>(e,t)=>{if(e.index!==t.index)return!1;const s=e.style,n=t.style;return ie(s,n)},ke=(e,t)=>(e.displayName===void 0&&("$$typeof"in e&&e.$$typeof?.toString().includes("Memo")?Object.assign(e,{displayName:t}):e.displayName=t),e),We="_row_u9p5z_14",Me="_dataCard_u9p5z_24",Te="_dataCardSelected_u9p5z_66",Ne="_dataCardEntered_u9p5z_72",M={row:We,dataCard:Me,dataCardSelected:Te,dataCardEntered:Ne},Ve=({items:e,style:t,gap:s=8,renderItem:n,rowIndex:i})=>{const[r,l]=d.useState(!1);if(d.useEffect(()=>{l(!0)},[]),!e?.length)return h.jsx("div",{className:B(M.row,r&&M.rowEntered),style:t});const o=(Number(t.height)||48)-s*2;return h.jsx("div",{className:B(M.row,r&&M.rowEntered),style:{...t,"--row-gap":`${s}px`,"--card-size":`${o}px`},children:e.map((c,f)=>h.jsx("div",{children:n(c)},f+i))})},re=d.memo(Ve,(e,t)=>e.rowIndex!==t.rowIndex||e.gap!==t.gap||e.items!==t.items||e.renderItem!==t.renderItem?!1:ie(e.style,t.style));ke(re,"Row");const He=({value:e,onToggle:t,className:s})=>{const[n,i]=d.useState(!1),[r,l]=d.useState(!1);d.useEffect(()=>{l(!0)},[]);const a=d.useCallback(()=>{i(!0),t?.()},[t]),o=d.useCallback(c=>{(c.key==="Enter"||c.key===" ")&&a()},[a]);return ce(()=>{i(!1)},n?200:null),h.jsx("div",{className:B(M.dataCard,{[M.dataCardSelected]:n,[M.dataCardEntered]:r},s),role:"button",tabIndex:0,"aria-pressed":n,"data-role":"data-card",onClick:a,onKeyDown:o,children:e})},$e=Object.freeze([]),ee=e=>{let t;const s=new Set,n=(c,f)=>{const u=typeof c=="function"?c(t):c;if(!Object.is(u,t)){const p=t;t=f??(typeof u!="object"||u===null)?u:Object.assign({},t,u),s.forEach(x=>x(t,p))}},i=()=>t,a={setState:n,getState:i,getInitialState:()=>o,subscribe:c=>(s.add(c),()=>s.delete(c))},o=t=e(n,i,a);return a},Ae=(e=>e?ee(e):ee),De=e=>e;function Pe(e,t=De){const s=G.useSyncExternalStore(e.subscribe,G.useCallback(()=>t(e.getState()),[e,t]),G.useCallback(()=>t(e.getInitialState()),[e,t]));return G.useDebugValue(s),s}const te=e=>{const t=Ae(e),s=n=>Pe(t,n);return Object.assign(s,t),s},Be=(e=>e?te(e):te),Le=e=>(t,s,n)=>{const i=n.subscribe;return n.subscribe=((l,a,o)=>{let c=l;if(a){const f=o?.equalityFn||Object.is;let u=l(n.getState());c=p=>{const x=l(p);if(!f(u,x)){const y=u;a(u=x,y)}},o?.fireImmediately&&a(u,u)}return i(c)}),e(t,s,n)},Ye=Le;let V=null,H=null,P=null,N=null,A=0;const Fe=1e4,Ge=()=>{if(typeof window>"u"||typeof Worker>"u")return null;try{return new Worker(new URL("/folio/assets/data-worker-CWteliLL.js",import.meta.url),{type:"module"})}catch{return null}},U=Ge(),Ue=async e=>e===0?Promise.resolve():V&&H&&A===e||N&&A===e?N:(A=e,V=null,H=null,P=null,N=null,U?(N=new Promise(t=>{const s=n=>{if(!n?.data||n.data.type!=="INIT_COMPLETE")return;const{entities:i,entityIds:r,rows:l,itemsPerRow:a}=n.data.payload;a===A&&(V=i,H=r,P=l,U.removeEventListener("message",s),t())};U.addEventListener("message",s),U.postMessage({type:"INIT",payload:{itemsPerRow:e,totalItems:Fe}})}),N):Promise.resolve()),$=Be()(Ye((e,t)=>{const s=async n=>{n!==0&&(await Ue(n),V&&H&&P&&e({entities:V,entityIds:H,rows:P,itemsPerRow:n}))};return{entities:V||{},entityIds:H||[],rows:P||[],itemsPerRow:A,gap:8,toggleValue:n=>e(i=>{const r=i.entities[n];return r?{entities:{...i.entities,[n]:{...r,value:r.value===0?1:0}}}:i}),setItemsPerRow:n=>{t().itemsPerRow!==n&&s(n)},getRowItemIds:n=>t().rows[n]||[],getEntityValue:n=>t().entities[n]?.value}})),qe=8,oe=d.memo(({itemId:e})=>{const t=$(i=>i.entities[e]?.value),s=$(i=>i.toggleValue),n=d.useCallback(()=>{s(e)},[e,s]);return t===void 0?null:h.jsx(He,{value:t,onToggle:n})},(e,t)=>e.itemId===t.itemId);oe.displayName="DataRowItem";const Ke=d.memo(({index:e,style:t})=>{const n=$(i=>i.rows)[e]??$e;return n?.length?h.jsx(re,{items:n,style:t,gap:qe,renderItem:i=>h.jsx(oe,{itemId:i}),rowIndex:e}):h.jsx("div",{style:t})},je()),Ze=e=>{},Je="_section_1ln24_14",Qe="_heading_1ln24_25",Xe="_subheading_1ln24_30",et="_loading_1ln24_37",tt="_dataContainer_1ln24_41",nt="_headingWrapper_1ln24_49",st="_subheadingWrapper_1ln24_56",W={section:Je,heading:Qe,subheading:Xe,loading:et,dataContainer:tt,headingWrapper:nt,subheadingWrapper:st},ae=56,q=8,it=({containerWidth:e})=>{if(e<=q)return 0;const s=ae-q*2+q,n=e-q;return Math.max(1,Math.floor(n/s))},rt=()=>{const e=d.useRef(null),t=d.useRef(null),s=le(t,!0).width,n=d.useDeferredValue(s);de(e,{threshold:0});const{screenHeight:i}=ue(),{isMobile:r}=fe(),l=i??600,a=$(u=>u.rows.length),o=$(u=>u.itemsPerRow),c=$(u=>u.setItemsPerRow);Ze({container:t.current}),d.useEffect(()=>{const u=it({containerWidth:n});u&&u!==o&&c(u)},[n,o,c]);const f="data-intensive-heading";return h.jsxs("div",{className:W.section,ref:e,"aria-labelledby":f,children:[h.jsx("div",{className:W.headingWrapper,children:h.jsx(Z,{id:f,variant:"h1",className:W.heading,children:"Data intensive"})}),h.jsx("div",{className:W.subheadingWrapper,children:h.jsxs(Z,{variant:"subheading",className:W.subheading,color:"muted",children:[h.jsx(Z,{as:"span",variant:"body",color:"primary",weight:"medium",children:"Issue:"})," ","Rendering ",a*o," data points"]})}),h.jsx(ne,{children:h.jsx("div",{ref:t,className:W.dataContainer,children:a>0?h.jsx(_e,{rowCount:a,rowComponent:Ke,rowHeight:ae,height:r?l*.6:600}):h.jsx("div",{className:W.loading,children:"Loading data..."})})})]})},at=d.memo(rt);export{at as DataIntensiveWidget};
