import{r as d,j as m,f as B,h as ce,R as q,k as le,c as de,e as ue,g as fe,T as Z}from"./index-C9A9xT9o.js";const he="_card_1p13l_14",me={card:he},ne=d.forwardRef(({children:e,className:t,as:s="div",...n},r)=>m.jsx(s,{ref:r,className:B(me.card,t),...n,children:e}));ne.displayName="Card";const L=typeof window<"u"?d.useLayoutEffect:d.useEffect;function Q(e){if(e!==void 0)switch(typeof e){case"number":return e;case"string":{if(e.endsWith("px"))return parseFloat(e);break}}}function ge({box:e,defaultHeight:t,defaultWidth:s,disabled:n,element:r,mode:i,style:l}){const{styleHeight:c,styleWidth:o}=d.useMemo(()=>({styleHeight:Q(l?.height),styleWidth:Q(l?.width)}),[l?.height,l?.width]),[a,u]=d.useState({height:t,width:s}),f=n||c!==void 0||i==="only-width"||c!==void 0&&o!==void 0;return L(()=>{if(r===null||f)return;const h=new ResizeObserver(b=>{for(const y of b){const{contentRect:S,target:w}=y;r===w&&u(I=>I.height===S.height&&I.width===S.width?I:{height:S.height,width:S.width})}});return h.observe(r,{box:e}),()=>{h?.unobserve(r)}},[e,f,r,c,o]),d.useMemo(()=>({height:c??a.height,width:o??a.width}),[a,c,o])}function we(e){const t=d.useRef(()=>{throw new Error("Cannot call during render.")});return L(()=>{t.current=e},[e]),d.useCallback(s=>t.current?.(s),[t])}function J({containerElement:e,direction:t,isRtl:s,scrollOffset:n}){return n}function j(e,t="Assertion error"){if(!e)throw console.error(t),Error(t)}function D(e,t){if(e===t)return!0;if(!!e!=!!t||(j(e!==void 0),j(t!==void 0),Object.keys(e).length!==Object.keys(t).length))return!1;for(const s in e)if(!Object.is(t[s],e[s]))return!1;return!0}function se({cachedBounds:e,itemCount:t,itemSize:s}){if(t===0)return 0;if(typeof s=="number")return t*s;{const n=e.get(e.size===0?0:e.size-1);j(n!==void 0,"Unexpected bounds cache miss");const r=(n.scrollOffset+n.size)/e.size;return t*r}}function be({align:e,cachedBounds:t,index:s,itemCount:n,itemSize:r,containerScrollOffset:i,containerSize:l}){if(s<0||s>=n)throw RangeError(`Invalid index specified: ${s}`,{cause:`Index ${s} is not within the range of 0 - ${n-1}`});const c=se({cachedBounds:t,itemCount:n,itemSize:r}),o=t.get(s),a=Math.max(0,Math.min(c-l,o.scrollOffset)),u=Math.max(0,o.scrollOffset-l+o.size);switch(e==="smart"&&(i>=u&&i<=a?e="auto":e="center"),e){case"start":return a;case"end":return u;case"center":return o.scrollOffset<=l/2?0:o.scrollOffset+o.size/2>=c-l/2?c-l:o.scrollOffset+o.size/2-l/2;case"auto":default:return i>=u&&i<=a?i:i<u?u:a}}function X({cachedBounds:e,containerScrollOffset:t,containerSize:s,itemCount:n,overscanCount:r}){const i=n-1;let l=0,c=-1,o=0,a=-1,u=0;for(;u<i;){const f=e.get(u);if(f.scrollOffset+f.size>t)break;u++}for(l=u,o=Math.max(0,l-r);u<i;){const f=e.get(u);if(f.scrollOffset+f.size>=t+s)break;u++}return c=Math.min(i,u),a=Math.min(n-1,c+r),l<0&&(l=0,c=-1,o=0,a=-1),{startIndexVisible:l,stopIndexVisible:c,startIndexOverscan:o,stopIndexOverscan:a}}function pe({itemCount:e,itemProps:t,itemSize:s}){const n=new Map;return{get(r){for(j(r<e,`Invalid index ${r}`);n.size-1<r;){const l=n.size;let c;switch(typeof s){case"function":{c=s(l,t);break}case"number":{c=s;break}}if(l===0)n.set(l,{size:c,scrollOffset:0});else{const o=n.get(l-1);j(o!==void 0,`Unexpected bounds cache miss for index ${r}`),n.set(l,{scrollOffset:o.scrollOffset+o.size,size:c})}}const i=n.get(r);return j(i!==void 0,`Unexpected bounds cache miss for index ${r}`),i},set(r,i){n.set(r,i)},get size(){return n.size}}}function xe({itemCount:e,itemProps:t,itemSize:s}){return d.useMemo(()=>pe({itemCount:e,itemProps:t,itemSize:s}),[e,t,s])}function ve({containerSize:e,itemSize:t}){let s;switch(typeof t){case"string":{j(t.endsWith("%"),`Invalid item size: "${t}"; string values must be percentages (e.g. "100%")`),j(e!==void 0,"Container size must be defined if a percentage item size is specified"),s=e*parseInt(t)/100;break}default:{s=t;break}}return s}function Ie({containerElement:e,containerStyle:t,defaultContainerSize:s=0,direction:n,isRtl:r=!1,itemCount:i,itemProps:l,itemSize:c,onResize:o,overscanCount:a}){const[u,f]=d.useState({startIndexVisible:0,startIndexOverscan:0,stopIndexVisible:-1,stopIndexOverscan:-1}),{startIndexVisible:h,startIndexOverscan:b,stopIndexVisible:y,stopIndexOverscan:S}={startIndexVisible:Math.min(i-1,u.startIndexVisible),startIndexOverscan:Math.min(i-1,u.startIndexOverscan),stopIndexVisible:Math.min(i-1,u.stopIndexVisible),stopIndexOverscan:Math.min(i-1,u.stopIndexOverscan)},{height:w=s,width:I=s}=ge({defaultHeight:s,defaultWidth:void 0,element:e,mode:"only-height",style:t}),O=d.useRef({height:0,width:0}),R=w,k=ve({containerSize:R,itemSize:c});d.useLayoutEffect(()=>{if(typeof o=="function"){const g=O.current;(g.height!==w||g.width!==I)&&(o({height:w,width:I},{...g}),g.height=w,g.width=I)}},[w,o,I]);const v=xe({itemCount:i,itemProps:l,itemSize:k}),F=d.useCallback(g=>v.get(g),[v]),z=d.useCallback(()=>se({cachedBounds:v,itemCount:i,itemSize:k}),[v,i,k]),T=d.useCallback(g=>{const _=J({containerElement:e,direction:n,isRtl:r,scrollOffset:g});return X({cachedBounds:v,containerScrollOffset:_,containerSize:R,itemCount:i,overscanCount:a})},[v,e,R,n,r,i,a]);L(()=>{const g=e?.scrollTop??0;f(T(g))},[e,n,T]),L(()=>{if(!e)return;const g=()=>{f(_=>{const{scrollLeft:Y,scrollTop:x}=e,p=J({containerElement:e,direction:n,isRtl:r,scrollOffset:x}),C=X({cachedBounds:v,containerScrollOffset:p,containerSize:R,itemCount:i,overscanCount:a});return D(C,_)?_:C})};return e.addEventListener("scroll",g),()=>{e.removeEventListener("scroll",g)}},[v,e,R,n,i,a]);const E=we(({align:g="auto",containerScrollOffset:_,index:Y})=>{let x=be({align:g,cachedBounds:v,containerScrollOffset:_,containerSize:R,index:Y,itemCount:i,itemSize:k});if(e){if(x=J({containerElement:e,direction:n,isRtl:r,scrollOffset:x}),typeof e.scrollTo!="function"){const p=T(x);D(u,p)||f(p)}return x}});return{getCellBounds:F,getEstimatedSize:z,scrollToIndex:E,startIndexOverscan:b,startIndexVisible:h,stopIndexOverscan:S,stopIndexVisible:y}}function ye(e){return d.useMemo(()=>e,Object.values(e))}function Se(e,t){const{ariaAttributes:s,style:n,...r}=e,{ariaAttributes:i,style:l,...c}=t;return D(s,i)&&D(n,l)&&D(r,c)}function ze(e){return e!=null&&typeof e=="object"&&"getAverageRowHeight"in e&&typeof e.getAverageRowHeight=="function"}const Ce="data-react-window-index";function Oe({children:e,className:t,defaultHeight:s=0,listRef:n,onResize:r,onRowsRendered:i,overscanCount:l=3,rowComponent:c,rowCount:o,rowHeight:a,rowProps:u,tagName:f="div",style:h,...b}){const y=ye(u),S=d.useMemo(()=>d.memo(c,Se),[c]),[w,I]=d.useState(null),O=ze(a),R=d.useMemo(()=>O?x=>a.getRowHeight(x)??a.getAverageRowHeight():a,[O,a]),{getCellBounds:k,getEstimatedSize:v,scrollToIndex:F,startIndexOverscan:z,startIndexVisible:T,stopIndexOverscan:E,stopIndexVisible:g}=Ie({containerElement:w,containerStyle:h,defaultContainerSize:s,direction:"vertical",itemCount:o,itemProps:y,itemSize:R,onResize:r,overscanCount:l});d.useImperativeHandle(n,()=>({get element(){return w},scrollToRow({align:x="auto",behavior:p="auto",index:C}){const K=F({align:x,containerScrollOffset:w?.scrollTop??0,index:C});typeof w?.scrollTo=="function"&&w.scrollTo({behavior:p,top:K})}}),[w,F]),L(()=>{if(!w)return;const x=Array.from(w.children).filter((p,C)=>{if(p.hasAttribute("aria-hidden"))return!1;const K=`${z+C}`;return p.setAttribute(Ce,K),!0});if(O)return a.observeRowElements(x)},[w,O,a,z,E]),d.useEffect(()=>{z>=0&&E>=0&&i&&i({startIndex:T,stopIndex:g},{startIndex:z,stopIndex:E})},[i,z,T,E,g]);const _=d.useMemo(()=>{const x=[];if(o>0)for(let p=z;p<=E;p++){const C=k(p);x.push(d.createElement(S,{...y,ariaAttributes:{"aria-posinset":p+1,"aria-setsize":o,role:"listitem"},key:p,index:p,style:{position:"absolute",left:0,transform:`translateY(${C.scrollOffset}px)`,height:O?void 0:C.size,width:"100%"}}))}return x},[S,k,O,o,y,z,E]),Y=m.jsx("div",{"aria-hidden":!0,style:{height:v(),width:"100%",zIndex:-1}});return d.createElement(f,{role:"list",...b,className:t,ref:I,style:{position:"relative",maxHeight:"100%",flexGrow:1,overflowY:"auto",...h}},_,e,Y)}const Re="_virtualizedTable_p8hv0_14",Ee={virtualizedTable:Re},_e=({rowCount:e,rowComponent:t,rowHeight:s=48,height:n=600,className:r="",onVisibleRowsChange:i,overscanCount:l=20})=>{const c=o=>m.jsx(t,{...o});return m.jsx("div",{className:B(Ee.virtualizedTable,r),style:{height:n},children:m.jsx(Oe,{rowComponent:c,rowCount:e,rowHeight:s,rowProps:{},overscanCount:l,onRowsRendered:({startIndex:o,stopIndex:a})=>{i&&i(o,a)},role:"presentation",style:{width:"100%",height:n}})})},re=(e,t)=>e.position===t.position&&e.top===t.top&&e.left===t.left&&e.width===t.width&&e.height===t.height,je=()=>(e,t)=>{if(e.index!==t.index)return!1;const s=e.style,n=t.style;return re(s,n)},ke=(e,t)=>(e.displayName===void 0&&("$$typeof"in e&&e.$$typeof?.toString().includes("Memo")?Object.assign(e,{displayName:t}):e.displayName=t),e),We="_row_u9p5z_14",Me="_dataCard_u9p5z_24",Te="_dataCardSelected_u9p5z_66",Ve="_dataCardEntered_u9p5z_72",M={row:We,dataCard:Me,dataCardSelected:Te,dataCardEntered:Ve},Ne=({items:e,style:t,gap:s=8,renderItem:n,rowIndex:r})=>{const[i,l]=d.useState(!1);if(d.useEffect(()=>{l(!0)},[]),!e?.length)return m.jsx("div",{className:B(M.row,i&&M.rowEntered),style:t});const o=(Number(t.height)||48)-s*2;return m.jsx("div",{className:B(M.row,i&&M.rowEntered),style:{...t,"--row-gap":`${s}px`,"--card-size":`${o}px`},children:e.map((a,u)=>m.jsx("div",{children:n(a)},u+r))})},ie=d.memo(Ne,(e,t)=>e.rowIndex!==t.rowIndex||e.gap!==t.gap||e.items!==t.items||e.renderItem!==t.renderItem?!1:re(e.style,t.style));ke(ie,"Row");const He=({value:e,onToggle:t,className:s})=>{const[n,r]=d.useState(!1),[i,l]=d.useState(!1);d.useEffect(()=>{l(!0)},[]);const c=d.useCallback(()=>{r(!0),t?.()},[t]),o=d.useCallback(a=>{(a.key==="Enter"||a.key===" ")&&c()},[c]);return ce(()=>{r(!1)},n?200:null),m.jsx("div",{className:B(M.dataCard,{[M.dataCardSelected]:n,[M.dataCardEntered]:i},s),role:"button",tabIndex:0,"aria-pressed":n,"data-role":"data-card",onClick:c,onKeyDown:o,children:e})},Ae=Object.freeze([]),ee=e=>{let t;const s=new Set,n=(a,u)=>{const f=typeof a=="function"?a(t):a;if(!Object.is(f,t)){const h=t;t=u??(typeof f!="object"||f===null)?f:Object.assign({},t,f),s.forEach(b=>b(t,h))}},r=()=>t,c={setState:n,getState:r,getInitialState:()=>o,subscribe:a=>(s.add(a),()=>s.delete(a))},o=t=e(n,r,c);return c},$e=(e=>e?ee(e):ee),De=e=>e;function Pe(e,t=De){const s=q.useSyncExternalStore(e.subscribe,q.useCallback(()=>t(e.getState()),[e,t]),q.useCallback(()=>t(e.getInitialState()),[e,t]));return q.useDebugValue(s),s}const te=e=>{const t=$e(e),s=n=>Pe(t,n);return Object.assign(s,t),s},Be=(e=>e?te(e):te),Le=e=>(t,s,n)=>{const r=n.subscribe;return n.subscribe=((l,c,o)=>{let a=l;if(c){const u=o?.equalityFn||Object.is;let f=l(n.getState());a=h=>{const b=l(h);if(!u(f,b)){const y=f;c(f=b,y)}},o?.fireImmediately&&c(f,f)}return r(a)}),e(t,s,n)},Fe=Le;let N=null,H=null,P=null,V=null,$=0;const Ye=1e4,qe=()=>{if(typeof window>"u"||typeof Worker>"u")return null;try{return new Worker(new URL("/folio/assets/data-worker-CWteliLL.js",import.meta.url),{type:"module"})}catch{return null}},G=qe(),Ge=async e=>e===0?Promise.resolve():N&&H&&$===e||V&&$===e?V:($=e,N=null,H=null,P=null,V=null,G?(V=new Promise(t=>{const s=n=>{if(!n?.data||n.data.type!=="INIT_COMPLETE")return;const{entities:r,entityIds:i,rows:l,itemsPerRow:c}=n.data.payload;c===$&&(N=r,H=i,P=l,G.removeEventListener("message",s),t())};G.addEventListener("message",s),G.postMessage({type:"INIT",payload:{itemsPerRow:e,totalItems:Ye}})}),V):Promise.resolve()),A=Be()(Fe((e,t)=>{const s=async n=>{n!==0&&(await Ge(n),N&&H&&P&&e({entities:N,entityIds:H,rows:P,itemsPerRow:n}))};return{entities:N||{},entityIds:H||[],rows:P||[],itemsPerRow:$,gap:8,toggleValue:n=>e(r=>{const i=r.entities[n];return i?{entities:{...r.entities,[n]:{...i,value:i.value===0?1:0}}}:r}),setItemsPerRow:n=>{t().itemsPerRow!==n&&s(n)},getRowItemIds:n=>t().rows[n]||[],getEntityValue:n=>t().entities[n]?.value}})),Ue=8,oe=d.memo(({itemId:e})=>{const t=A(r=>r.entities[e]?.value),s=A(r=>r.toggleValue),n=d.useCallback(()=>{s(e)},[e,s]);return t===void 0?null:m.jsx(He,{value:t,onToggle:n})},(e,t)=>e.itemId===t.itemId);oe.displayName="DataRowItem";const Ke=d.memo(({index:e,style:t})=>{const n=A(r=>r.rows)[e]??Ae;return n?.length?m.jsx(ie,{items:n,style:t,gap:Ue,renderItem:r=>m.jsx(oe,{itemId:r}),rowIndex:e}):m.jsx("div",{style:t})},je()),Ze=({container:e,isEnabled:t,flashCount:s=6,flashDurationMs:n=500,intervalMs:r=200})=>{d.useEffect(()=>{if(!t||!e||s<=0||r<=0||n<=0)return;const l=setInterval(()=>{if(typeof document<"u"&&document.hidden)return;const c=e.querySelectorAll('[data-role="data-card"]'),o=c.length;if(!o)return;const a=Math.min(s,o),u=()=>Math.floor(Math.random()*o);for(let f=0;f<a;f++){const h=u(),b=c[h];b&&b.dataset.flash!=="true"&&(b.dataset.flash="true",setTimeout(()=>{b.dataset.flash==="true"&&(b.dataset.flash="false")},n))}},r);return()=>clearInterval(l)},[e,s,n,r,t])},Je="_section_1ln24_14",Qe="_heading_1ln24_25",Xe="_subheading_1ln24_30",et="_loading_1ln24_37",tt="_dataContainer_1ln24_41",nt="_headingWrapper_1ln24_49",st="_subheadingWrapper_1ln24_56",W={section:Je,heading:Qe,subheading:Xe,loading:et,dataContainer:tt,headingWrapper:nt,subheadingWrapper:st},ae=56,U=8,rt=({containerWidth:e})=>{if(e<=U)return 0;const s=ae-U*2+U,n=e-U;return Math.max(1,Math.floor(n/s))},it=()=>{const e=d.useRef(null),t=d.useRef(null),s=le(t,!0).width,n=d.useDeferredValue(s),r=de(e,{threshold:0}),{screenHeight:i}=ue(),{isMobile:l}=fe(),c=i??600,o=A(h=>h.rows.length),a=A(h=>h.itemsPerRow),u=A(h=>h.setItemsPerRow);Ze({container:t.current,isEnabled:o>0&&a>0&&r}),d.useEffect(()=>{const h=rt({containerWidth:n});h&&h!==a&&u(h)},[n,a,u]);const f="data-intensive-heading";return m.jsxs("div",{className:W.section,ref:e,"aria-labelledby":f,children:[m.jsx("div",{className:W.headingWrapper,children:m.jsx(Z,{id:f,variant:"h1",className:W.heading,children:"Data intensive"})}),m.jsx("div",{className:W.subheadingWrapper,children:m.jsxs(Z,{variant:"subheading",className:W.subheading,color:"muted",children:[m.jsx(Z,{as:"span",variant:"body",color:"primary",weight:"medium",children:"Issue:"})," ","Rendering ",o*a," data points"]})}),m.jsx(ne,{children:m.jsx("div",{ref:t,className:W.dataContainer,children:o>0?m.jsx(_e,{rowCount:o,rowComponent:Ke,rowHeight:ae,height:l?c*.6:600}):m.jsx("div",{className:W.loading,children:"Loading data..."})})})]})},at=d.memo(it);export{at as DataIntensiveWidget};
