import{r as d,j as h,f as J,h as ce,R as Y,k as le,c as de,e as ue,T as K,g as fe}from"./index-BzWaAogi.js";const L=typeof window<"u"?d.useLayoutEffect:d.useEffect;function Q(e){if(e!==void 0)switch(typeof e){case"number":return e;case"string":{if(e.endsWith("px"))return parseFloat(e);break}}}function he({box:e,defaultHeight:t,defaultWidth:s,disabled:n,element:r,mode:i,style:c}){const{styleHeight:o,styleWidth:a}=d.useMemo(()=>({styleHeight:Q(c?.height),styleWidth:Q(c?.width)}),[c?.height,c?.width]),[l,f]=d.useState({height:t,width:s}),u=n||o!==void 0||i==="only-width"||o!==void 0&&a!==void 0;return L(()=>{if(r===null||u)return;const v=new ResizeObserver(p=>{for(const y of p){const{contentRect:S,target:g}=y;r===g&&f(I=>I.height===S.height&&I.width===S.width?I:{height:S.height,width:S.width})}});return v.observe(r,{box:e}),()=>{v?.unobserve(r)}},[e,u,r,o,a]),d.useMemo(()=>({height:o??l.height,width:a??l.width}),[l,o,a])}function me(e){const t=d.useRef(()=>{throw new Error("Cannot call during render.")});return L(()=>{t.current=e},[e]),d.useCallback(s=>t.current?.(s),[t])}function Z({containerElement:e,direction:t,isRtl:s,scrollOffset:n}){return n}function k(e,t="Assertion error"){if(!e)throw console.error(t),Error(t)}function H(e,t){if(e===t)return!0;if(!!e!=!!t||(k(e!==void 0),k(t!==void 0),Object.keys(e).length!==Object.keys(t).length))return!1;for(const s in e)if(!Object.is(t[s],e[s]))return!1;return!0}function ne({cachedBounds:e,itemCount:t,itemSize:s}){if(t===0)return 0;if(typeof s=="number")return t*s;{const n=e.get(e.size===0?0:e.size-1);k(n!==void 0,"Unexpected bounds cache miss");const r=(n.scrollOffset+n.size)/e.size;return t*r}}function ge({align:e,cachedBounds:t,index:s,itemCount:n,itemSize:r,containerScrollOffset:i,containerSize:c}){if(s<0||s>=n)throw RangeError(`Invalid index specified: ${s}`,{cause:`Index ${s} is not within the range of 0 - ${n-1}`});const o=ne({cachedBounds:t,itemCount:n,itemSize:r}),a=t.get(s),l=Math.max(0,Math.min(o-c,a.scrollOffset)),f=Math.max(0,a.scrollOffset-c+a.size);switch(e==="smart"&&(i>=f&&i<=l?e="auto":e="center"),e){case"start":return l;case"end":return f;case"center":return a.scrollOffset<=c/2?0:a.scrollOffset+a.size/2>=o-c/2?o-c:a.scrollOffset+a.size/2-c/2;case"auto":default:return i>=f&&i<=l?i:i<f?f:l}}function X({cachedBounds:e,containerScrollOffset:t,containerSize:s,itemCount:n,overscanCount:r}){const i=n-1;let c=0,o=-1,a=0,l=-1,f=0;for(;f<i;){const u=e.get(f);if(u.scrollOffset+u.size>t)break;f++}for(c=f,a=Math.max(0,c-r);f<i;){const u=e.get(f);if(u.scrollOffset+u.size>=t+s)break;f++}return o=Math.min(i,f),l=Math.min(n-1,o+r),c<0&&(c=0,o=-1,a=0,l=-1),{startIndexVisible:c,stopIndexVisible:o,startIndexOverscan:a,stopIndexOverscan:l}}function pe({itemCount:e,itemProps:t,itemSize:s}){const n=new Map;return{get(r){for(k(r<e,`Invalid index ${r}`);n.size-1<r;){const c=n.size;let o;switch(typeof s){case"function":{o=s(c,t);break}case"number":{o=s;break}}if(c===0)n.set(c,{size:o,scrollOffset:0});else{const a=n.get(c-1);k(a!==void 0,`Unexpected bounds cache miss for index ${r}`),n.set(c,{scrollOffset:a.scrollOffset+a.size,size:o})}}const i=n.get(r);return k(i!==void 0,`Unexpected bounds cache miss for index ${r}`),i},set(r,i){n.set(r,i)},get size(){return n.size}}}function be({itemCount:e,itemProps:t,itemSize:s}){return d.useMemo(()=>pe({itemCount:e,itemProps:t,itemSize:s}),[e,t,s])}function we({containerSize:e,itemSize:t}){let s;switch(typeof t){case"string":{k(t.endsWith("%"),`Invalid item size: "${t}"; string values must be percentages (e.g. "100%")`),k(e!==void 0,"Container size must be defined if a percentage item size is specified"),s=e*parseInt(t)/100;break}default:{s=t;break}}return s}function ve({containerElement:e,containerStyle:t,defaultContainerSize:s=0,direction:n,isRtl:r=!1,itemCount:i,itemProps:c,itemSize:o,onResize:a,overscanCount:l}){const[f,u]=d.useState({startIndexVisible:0,startIndexOverscan:0,stopIndexVisible:-1,stopIndexOverscan:-1}),{startIndexVisible:v,startIndexOverscan:p,stopIndexVisible:y,stopIndexOverscan:S}={startIndexVisible:Math.min(i-1,f.startIndexVisible),startIndexOverscan:Math.min(i-1,f.startIndexOverscan),stopIndexVisible:Math.min(i-1,f.stopIndexVisible),stopIndexOverscan:Math.min(i-1,f.stopIndexOverscan)},{height:g=s,width:I=s}=he({defaultHeight:s,defaultWidth:void 0,element:e,mode:"only-height",style:t}),O=d.useRef({height:0,width:0}),R=g,W=we({containerSize:R,itemSize:o});d.useLayoutEffect(()=>{if(typeof a=="function"){const m=O.current;(m.height!==g||m.width!==I)&&(a({height:g,width:I},{...m}),m.height=g,m.width=I)}},[g,a,I]);const x=be({itemCount:i,itemProps:c,itemSize:W}),D=d.useCallback(m=>x.get(m),[x]),z=d.useCallback(()=>ne({cachedBounds:x,itemCount:i,itemSize:W}),[x,i,W]),T=d.useCallback(m=>{const _=Z({containerElement:e,direction:n,isRtl:r,scrollOffset:m});return X({cachedBounds:x,containerScrollOffset:_,containerSize:R,itemCount:i,overscanCount:l})},[x,e,R,n,r,i,l]);L(()=>{const m=e?.scrollTop??0;u(T(m))},[e,n,T]),L(()=>{if(!e)return;const m=()=>{u(_=>{const{scrollLeft:F,scrollTop:w}=e,b=Z({containerElement:e,direction:n,isRtl:r,scrollOffset:w}),C=X({cachedBounds:x,containerScrollOffset:b,containerSize:R,itemCount:i,overscanCount:l});return H(C,_)?_:C})};return e.addEventListener("scroll",m),()=>{e.removeEventListener("scroll",m)}},[x,e,R,n,i,l]);const E=me(({align:m="auto",containerScrollOffset:_,index:F})=>{let w=ge({align:m,cachedBounds:x,containerScrollOffset:_,containerSize:R,index:F,itemCount:i,itemSize:W});if(e){if(w=Z({containerElement:e,direction:n,isRtl:r,scrollOffset:w}),typeof e.scrollTo!="function"){const b=T(w);H(f,b)||u(b)}return w}});return{getCellBounds:D,getEstimatedSize:z,scrollToIndex:E,startIndexOverscan:p,startIndexVisible:v,stopIndexOverscan:S,stopIndexVisible:y}}function xe(e){return d.useMemo(()=>e,Object.values(e))}function Ie(e,t){const{ariaAttributes:s,style:n,...r}=e,{ariaAttributes:i,style:c,...o}=t;return H(s,i)&&H(n,c)&&H(r,o)}function ye(e){return e!=null&&typeof e=="object"&&"getAverageRowHeight"in e&&typeof e.getAverageRowHeight=="function"}const Se="data-react-window-index";function ze({children:e,className:t,defaultHeight:s=0,listRef:n,onResize:r,onRowsRendered:i,overscanCount:c=3,rowComponent:o,rowCount:a,rowHeight:l,rowProps:f,tagName:u="div",style:v,...p}){const y=xe(f),S=d.useMemo(()=>d.memo(o,Ie),[o]),[g,I]=d.useState(null),O=ye(l),R=d.useMemo(()=>O?w=>l.getRowHeight(w)??l.getAverageRowHeight():l,[O,l]),{getCellBounds:W,getEstimatedSize:x,scrollToIndex:D,startIndexOverscan:z,startIndexVisible:T,stopIndexOverscan:E,stopIndexVisible:m}=ve({containerElement:g,containerStyle:v,defaultContainerSize:s,direction:"vertical",itemCount:a,itemProps:y,itemSize:R,onResize:r,overscanCount:c});d.useImperativeHandle(n,()=>({get element(){return g},scrollToRow({align:w="auto",behavior:b="auto",index:C}){const U=D({align:w,containerScrollOffset:g?.scrollTop??0,index:C});typeof g?.scrollTo=="function"&&g.scrollTo({behavior:b,top:U})}}),[g,D]),L(()=>{if(!g)return;const w=Array.from(g.children).filter((b,C)=>{if(b.hasAttribute("aria-hidden"))return!1;const U=`${z+C}`;return b.setAttribute(Se,U),!0});if(O)return l.observeRowElements(w)},[g,O,l,z,E]),d.useEffect(()=>{z>=0&&E>=0&&i&&i({startIndex:T,stopIndex:m},{startIndex:z,stopIndex:E})},[i,z,T,E,m]);const _=d.useMemo(()=>{const w=[];if(a>0)for(let b=z;b<=E;b++){const C=W(b);w.push(d.createElement(S,{...y,ariaAttributes:{"aria-posinset":b+1,"aria-setsize":a,role:"listitem"},key:b,index:b,style:{position:"absolute",left:0,transform:`translateY(${C.scrollOffset}px)`,height:O?void 0:C.size,width:"100%"}}))}return w},[S,W,O,a,y,z,E]),F=h.jsx("div",{"aria-hidden":!0,style:{height:x(),width:"100%",zIndex:-1}});return d.createElement(u,{role:"list",...p,className:t,ref:I,style:{position:"relative",maxHeight:"100%",flexGrow:1,overflowY:"auto",...v}},_,e,F)}const Ce="_virtualizedTable_p8hv0_14",Oe={virtualizedTable:Ce},Re=({rowCount:e,rowComponent:t,rowHeight:s=48,height:n=600,className:r="",onVisibleRowsChange:i,overscanCount:c=20})=>{const o=a=>h.jsx(t,{...a});return h.jsx("div",{className:J(Oe.virtualizedTable,r),style:{height:n},children:h.jsx(ze,{rowComponent:o,rowCount:e,rowHeight:s,rowProps:{},overscanCount:c,onRowsRendered:({startIndex:a,stopIndex:l})=>{i&&i(a,l)},role:"presentation",style:{width:"100%",height:n}})})},Ee="_card_1p13l_14",_e={card:Ee},se=d.forwardRef(({children:e,className:t,as:s="div",...n},r)=>h.jsx(s,{ref:r,className:J(_e.card,t),...n,children:e}));se.displayName="Card";const re=(e,t)=>e.position===t.position&&e.top===t.top&&e.left===t.left&&e.width===t.width&&e.height===t.height,je=()=>(e,t)=>{if(e.index!==t.index)return!1;const s=e.style,n=t.style;return re(s,n)},ke=(e,t)=>(e.displayName===void 0&&("$$typeof"in e&&e.$$typeof?.toString().includes("Memo")?Object.assign(e,{displayName:t}):e.displayName=t),e),We="_row_u9p5z_14",Te="_dataCard_u9p5z_24",Me="_dataCardSelected_u9p5z_66",Ne="_dataCardEntered_u9p5z_72",B={row:We,dataCard:Te,dataCardSelected:Me,dataCardEntered:Ne},$e=({items:e,style:t,gap:s=8,renderItem:n,rowIndex:r})=>{if(!e?.length)return h.jsx("div",{className:B.row,style:t});const c=(Number(t.height)||48)-s*2;return h.jsx("div",{className:B.row,style:{...t,"--row-gap":`${s}px`,"--card-size":`${c}px`},children:e.map((o,a)=>h.jsx("div",{children:n(o)},a+r))})},ie=d.memo($e,(e,t)=>e.rowIndex!==t.rowIndex||e.gap!==t.gap||e.items!==t.items||e.renderItem!==t.renderItem?!1:re(e.style,t.style));ke(ie,"Row");const Ve=({value:e,onToggle:t,className:s})=>{const[n,r]=d.useState(!1),[i,c]=d.useState(!1);d.useEffect(()=>{c(!0)},[]);const o=d.useCallback(()=>{r(!0),t?.()},[t]),a=d.useCallback(l=>{(l.key==="Enter"||l.key===" ")&&o()},[o]);return ce(()=>{r(!1)},n?200:null),h.jsx("div",{className:J(B.dataCard,{[B.dataCardSelected]:n,[B.dataCardEntered]:i},s),role:"button",tabIndex:0,"aria-pressed":n,"data-role":"data-card",onClick:o,onKeyDown:a,children:e})},Ae=Object.freeze([]),ee=e=>{let t;const s=new Set,n=(l,f)=>{const u=typeof l=="function"?l(t):l;if(!Object.is(u,t)){const v=t;t=f??(typeof u!="object"||u===null)?u:Object.assign({},t,u),s.forEach(p=>p(t,v))}},r=()=>t,o={setState:n,getState:r,getInitialState:()=>a,subscribe:l=>(s.add(l),()=>s.delete(l))},a=t=e(n,r,o);return o},He=(e=>e?ee(e):ee),Be=e=>e;function Pe(e,t=Be){const s=Y.useSyncExternalStore(e.subscribe,Y.useCallback(()=>t(e.getState()),[e,t]),Y.useCallback(()=>t(e.getInitialState()),[e,t]));return Y.useDebugValue(s),s}const te=e=>{const t=He(e),s=n=>Pe(t,n);return Object.assign(s,t),s},Le=(e=>e?te(e):te),De=e=>(t,s,n)=>{const r=n.subscribe;return n.subscribe=((c,o,a)=>{let l=c;if(o){const f=a?.equalityFn||Object.is;let u=c(n.getState());l=v=>{const p=c(v);if(!f(u,p)){const y=u;o(u=p,y)}},a?.fireImmediately&&o(u,u)}return r(l)}),e(t,s,n)},Fe=De;let N=null,$=null,P=null,M=null,A=0;const Ye=1e4,qe=()=>{if(typeof window>"u"||typeof Worker>"u")return null;try{return new Worker(new URL("/folio/assets/data-worker-CWteliLL.js",import.meta.url),{type:"module"})}catch{return null}},q=qe(),Ge=async e=>e===0?Promise.resolve():N&&$&&A===e||M&&A===e?M:(A=e,N=null,$=null,P=null,M=null,q?(M=new Promise(t=>{const s=n=>{if(!n?.data||n.data.type!=="INIT_COMPLETE")return;const{entities:r,entityIds:i,rows:c,itemsPerRow:o}=n.data.payload;o===A&&(N=r,$=i,P=c,q.removeEventListener("message",s),t())};q.addEventListener("message",s),q.postMessage({type:"INIT",payload:{itemsPerRow:e,totalItems:Ye}})}),M):Promise.resolve()),V=Le()(Fe((e,t)=>{const s=async n=>{n!==0&&(await Ge(n),N&&$&&P&&e({entities:N,entityIds:$,rows:P,itemsPerRow:n}))};return{entities:N||{},entityIds:$||[],rows:P||[],itemsPerRow:A,gap:8,toggleValue:n=>e(r=>{const i=r.entities[n];return i?{entities:{...r.entities,[n]:{...i,value:i.value===0?1:0}}}:r}),setItemsPerRow:n=>{t().itemsPerRow!==n&&s(n)},getRowItemIds:n=>t().rows[n]||[],getEntityValue:n=>t().entities[n]?.value}})),Ue=8,ae=d.memo(({itemId:e})=>{const t=V(r=>r.entities[e]?.value),s=V(r=>r.toggleValue),n=d.useCallback(()=>{s(e)},[e,s]);return t===void 0?null:h.jsx(Ve,{value:t,onToggle:n})},(e,t)=>e.itemId===t.itemId);ae.displayName="DataRowItem";const Ke=d.memo(({index:e,style:t})=>{const s=V(i=>i.rows),n=d.useMemo(()=>s[e]??Ae,[s,e]),r=d.useCallback(i=>h.jsx(ae,{itemId:i}),[]);return n?.length?h.jsx(ie,{items:n,style:t,gap:Ue,renderItem:r,rowIndex:e}):h.jsx("div",{style:t})},je()),Ze=({container:e,isEnabled:t,flashCount:s=6,flashDurationMs:n=500,intervalMs:r=200})=>{d.useEffect(()=>{if(!t||!e||s<=0||r<=0||n<=0)return;const c=setInterval(()=>{if(typeof document<"u"&&document.hidden)return;const o=e.querySelectorAll('[data-role="data-card"]'),a=o.length;if(!a)return;const l=Math.min(s,a),f=()=>Math.floor(Math.random()*a);for(let u=0;u<l;u++){const v=f(),p=o[v];p&&p.dataset.flash!=="true"&&(p.dataset.flash="true",setTimeout(()=>{p.dataset.flash==="true"&&(p.dataset.flash="false")},n))}},r);return()=>clearInterval(c)},[e,s,n,r,t])},Je="_section_s97t6_14",Qe="_heading_s97t6_25",Xe="_subheading_s97t6_30",et="_loading_s97t6_37",tt="_dataContainer_s97t6_41",nt="_headingWrapper_s97t6_47",st="_subheadingWrapper_s97t6_54",rt="_dataContainerWrapper_s97t6_59",j={section:Je,heading:Qe,subheading:Xe,loading:et,dataContainer:tt,headingWrapper:nt,subheadingWrapper:st,dataContainerWrapper:rt},oe=56,G=8,it=({containerWidth:e})=>{if(e<=G)return 0;const s=oe-G*2+G,n=e-G;return Math.max(1,Math.floor(n/s))},at=d.memo(()=>{const e=d.useRef(null),t=d.useRef(null),s=le(t,!0).width,n=de(e,{threshold:0}),{screenHeight:r,screenWidth:i}=ue(),c=r||600,o=V(u=>u.rows.length),a=V(u=>u.itemsPerRow),l=V(u=>u.setItemsPerRow);Ze({container:t.current,isEnabled:o>0&&a>0&&n}),d.useEffect(()=>{const u=it({containerWidth:s});!u||u===a||l(u)},[s,a,l]);const f="data-intensive-heading";return h.jsxs("div",{className:j.section,ref:e,"aria-labelledby":f,children:[h.jsx("div",{className:j.headingWrapper,children:h.jsx(K,{id:f,variant:"h1",className:j.heading,children:"Data intensive"})}),h.jsx("div",{className:j.subheadingWrapper,children:h.jsxs(K,{variant:"subheading",className:j.subheading,color:"muted",children:[h.jsx(K,{as:"span",variant:"body",color:"primary",weight:"medium",children:"Issue:"})," ","Rendering ",o*a," data points"]})}),h.jsx(se,{children:h.jsx("div",{ref:t,className:`${j.dataContainer} ${j.dataContainerWrapper}`,children:o>0?h.jsx(Re,{rowCount:o,rowComponent:Ke,rowHeight:oe,height:i<fe.MOBILE?c*.6:600}):h.jsx("div",{className:j.loading,children:"Loading data..."})})})]})});at.displayName="ThirdScreen";export{at as ThirdScreen};
