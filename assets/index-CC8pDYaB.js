import{r as u,j as h,f as G,h as ae,R as Z,k as oe,c as ce,e as de,T as q}from"./index-CaLDeMkd.js";const le="_card_1lwov_46",ue={card:le},te=u.forwardRef(({children:e,className:t,as:s="div",...n},r)=>h.jsx(s,{ref:r,className:G(ue.card,t),...n,children:e}));te.displayName="Card";const B=typeof window<"u"?u.useLayoutEffect:u.useEffect;function J(e){if(e!==void 0)switch(typeof e){case"number":return e;case"string":{if(e.endsWith("px"))return parseFloat(e);break}}}function fe({box:e,defaultHeight:t,defaultWidth:s,disabled:n,element:r,mode:i,style:o}){const{styleHeight:d,styleWidth:a}=u.useMemo(()=>({styleHeight:J(o?.height),styleWidth:J(o?.width)}),[o?.height,o?.width]),[c,l]=u.useState({height:t,width:s}),f=n||d!==void 0||i==="only-width"||d!==void 0&&a!==void 0;return B(()=>{if(r===null||f)return;const x=new ResizeObserver(p=>{for(const C of p){const{contentRect:S,target:g}=C;r===g&&l(I=>I.height===S.height&&I.width===S.width?I:{height:S.height,width:S.width})}});return x.observe(r,{box:e}),()=>{x?.unobserve(r)}},[e,f,r,d,a]),u.useMemo(()=>({height:d??c.height,width:a??c.width}),[c,d,a])}function he(e){const t=u.useRef(()=>{throw new Error("Cannot call during render.")});return B(()=>{t.current=e},[e]),u.useCallback(s=>t.current?.(s),[t])}function K({containerElement:e,direction:t,isRtl:s,scrollOffset:n}){return n}function k(e,t="Assertion error"){if(!e)throw console.error(t),Error(t)}function P(e,t){if(e===t)return!0;if(!!e!=!!t||(k(e!==void 0),k(t!==void 0),Object.keys(e).length!==Object.keys(t).length))return!1;for(const s in e)if(!Object.is(t[s],e[s]))return!1;return!0}function ne({cachedBounds:e,itemCount:t,itemSize:s}){if(t===0)return 0;if(typeof s=="number")return t*s;{const n=e.get(e.size===0?0:e.size-1);k(n!==void 0,"Unexpected bounds cache miss");const r=(n.scrollOffset+n.size)/e.size;return t*r}}function me({align:e,cachedBounds:t,index:s,itemCount:n,itemSize:r,containerScrollOffset:i,containerSize:o}){if(s<0||s>=n)throw RangeError(`Invalid index specified: ${s}`,{cause:`Index ${s} is not within the range of 0 - ${n-1}`});const d=ne({cachedBounds:t,itemCount:n,itemSize:r}),a=t.get(s),c=Math.max(0,Math.min(d-o,a.scrollOffset)),l=Math.max(0,a.scrollOffset-o+a.size);switch(e==="smart"&&(i>=l&&i<=c?e="auto":e="center"),e){case"start":return c;case"end":return l;case"center":return a.scrollOffset<=o/2?0:a.scrollOffset+a.size/2>=d-o/2?d-o:a.scrollOffset+a.size/2-o/2;case"auto":default:return i>=l&&i<=c?i:i<l?l:c}}function Q({cachedBounds:e,containerScrollOffset:t,containerSize:s,itemCount:n,overscanCount:r}){const i=n-1;let o=0,d=-1,a=0,c=-1,l=0;for(;l<i;){const f=e.get(l);if(f.scrollOffset+f.size>t)break;l++}for(o=l,a=Math.max(0,o-r);l<i;){const f=e.get(l);if(f.scrollOffset+f.size>=t+s)break;l++}return d=Math.min(i,l),c=Math.min(n-1,d+r),o<0&&(o=0,d=-1,a=0,c=-1),{startIndexVisible:o,stopIndexVisible:d,startIndexOverscan:a,stopIndexOverscan:c}}function ge({itemCount:e,itemProps:t,itemSize:s}){const n=new Map;return{get(r){for(k(r<e,`Invalid index ${r}`);n.size-1<r;){const o=n.size;let d;switch(typeof s){case"function":{d=s(o,t);break}case"number":{d=s;break}}if(o===0)n.set(o,{size:d,scrollOffset:0});else{const a=n.get(o-1);k(a!==void 0,`Unexpected bounds cache miss for index ${r}`),n.set(o,{scrollOffset:a.scrollOffset+a.size,size:d})}}const i=n.get(r);return k(i!==void 0,`Unexpected bounds cache miss for index ${r}`),i},set(r,i){n.set(r,i)},get size(){return n.size}}}function we({itemCount:e,itemProps:t,itemSize:s}){return u.useMemo(()=>ge({itemCount:e,itemProps:t,itemSize:s}),[e,t,s])}function be({containerSize:e,itemSize:t}){let s;switch(typeof t){case"string":{k(t.endsWith("%"),`Invalid item size: "${t}"; string values must be percentages (e.g. "100%")`),k(e!==void 0,"Container size must be defined if a percentage item size is specified"),s=e*parseInt(t)/100;break}default:{s=t;break}}return s}function xe({containerElement:e,containerStyle:t,defaultContainerSize:s=0,direction:n,isRtl:r=!1,itemCount:i,itemProps:o,itemSize:d,onResize:a,overscanCount:c}){const[l,f]=u.useState({startIndexVisible:0,startIndexOverscan:0,stopIndexVisible:-1,stopIndexOverscan:-1}),{startIndexVisible:x,startIndexOverscan:p,stopIndexVisible:C,stopIndexOverscan:S}={startIndexVisible:Math.min(i-1,l.startIndexVisible),startIndexOverscan:Math.min(i-1,l.startIndexOverscan),stopIndexVisible:Math.min(i-1,l.stopIndexVisible),stopIndexOverscan:Math.min(i-1,l.stopIndexOverscan)},{height:g=s,width:I=s}=fe({defaultHeight:s,defaultWidth:void 0,element:e,mode:"only-height",style:t}),R=u.useRef({height:0,width:0}),_=g,T=be({containerSize:_,itemSize:d});u.useLayoutEffect(()=>{if(typeof a=="function"){const m=R.current;(m.height!==g||m.width!==I)&&(a({height:g,width:I},{...m}),m.height=g,m.width=I)}},[g,a,I]);const v=we({itemCount:i,itemProps:o,itemSize:T}),L=u.useCallback(m=>v.get(m),[v]),y=u.useCallback(()=>ne({cachedBounds:v,itemCount:i,itemSize:T}),[v,i,T]),A=u.useCallback(m=>{const j=K({containerElement:e,direction:n,isRtl:r,scrollOffset:m});return Q({cachedBounds:v,containerScrollOffset:j,containerSize:_,itemCount:i,overscanCount:c})},[v,e,_,n,r,i,c]);B(()=>{const m=e?.scrollTop??0;f(A(m))},[e,n,A]),B(()=>{if(!e)return;const m=()=>{f(j=>{const{scrollLeft:Y,scrollTop:b}=e,w=K({containerElement:e,direction:n,isRtl:r,scrollOffset:b}),z=Q({cachedBounds:v,containerScrollOffset:w,containerSize:_,itemCount:i,overscanCount:c});return P(z,j)?j:z})};return e.addEventListener("scroll",m),()=>{e.removeEventListener("scroll",m)}},[v,e,_,n,i,c]);const E=he(({align:m="auto",containerScrollOffset:j,index:Y})=>{let b=me({align:m,cachedBounds:v,containerScrollOffset:j,containerSize:_,index:Y,itemCount:i,itemSize:T});if(e){if(b=K({containerElement:e,direction:n,isRtl:r,scrollOffset:b}),typeof e.scrollTo!="function"){const w=A(b);P(l,w)||f(w)}return b}});return{getCellBounds:L,getEstimatedSize:y,scrollToIndex:E,startIndexOverscan:p,startIndexVisible:x,stopIndexOverscan:S,stopIndexVisible:C}}function ve(e){return u.useMemo(()=>e,Object.values(e))}function pe(e,t){const{ariaAttributes:s,style:n,...r}=e,{ariaAttributes:i,style:o,...d}=t;return P(s,i)&&P(n,o)&&P(r,d)}function Ie(e){return e!=null&&typeof e=="object"&&"getAverageRowHeight"in e&&typeof e.getAverageRowHeight=="function"}const Ce="data-react-window-index";function Se({children:e,className:t,defaultHeight:s=0,listRef:n,onResize:r,onRowsRendered:i,overscanCount:o=3,rowComponent:d,rowCount:a,rowHeight:c,rowProps:l,tagName:f="div",style:x,...p}){const C=ve(l),S=u.useMemo(()=>u.memo(d,pe),[d]),[g,I]=u.useState(null),R=Ie(c),_=u.useMemo(()=>R?b=>c.getRowHeight(b)??c.getAverageRowHeight():c,[R,c]),{getCellBounds:T,getEstimatedSize:v,scrollToIndex:L,startIndexOverscan:y,startIndexVisible:A,stopIndexOverscan:E,stopIndexVisible:m}=xe({containerElement:g,containerStyle:x,defaultContainerSize:s,direction:"vertical",itemCount:a,itemProps:C,itemSize:_,onResize:r,overscanCount:o});u.useImperativeHandle(n,()=>({get element(){return g},scrollToRow({align:b="auto",behavior:w="auto",index:z}){const U=L({align:b,containerScrollOffset:g?.scrollTop??0,index:z});typeof g?.scrollTo=="function"&&g.scrollTo({behavior:w,top:U})}}),[g,L]),B(()=>{if(!g)return;const b=Array.from(g.children).filter((w,z)=>{if(w.hasAttribute("aria-hidden"))return!1;const U=`${y+z}`;return w.setAttribute(Ce,U),!0});if(R)return c.observeRowElements(b)},[g,R,c,y,E]),u.useEffect(()=>{y>=0&&E>=0&&i&&i({startIndex:A,stopIndex:m},{startIndex:y,stopIndex:E})},[i,y,A,E,m]);const j=u.useMemo(()=>{const b=[];if(a>0)for(let w=y;w<=E;w++){const z=T(w);b.push(u.createElement(S,{...C,ariaAttributes:{"aria-posinset":w+1,"aria-setsize":a,role:"listitem"},key:w,index:w,style:{position:"absolute",left:0,transform:`translateY(${z.scrollOffset}px)`,height:R?void 0:z.size,width:"100%"}}))}return b},[S,T,R,a,C,y,E]),Y=h.jsx("div",{"aria-hidden":!0,style:{height:v(),width:"100%",zIndex:-1}});return u.createElement(f,{role:"list",...p,className:t,ref:I,style:{position:"relative",maxHeight:"100%",flexGrow:1,overflowY:"auto",...x}},j,e,Y)}const ye="_virtualizedTable_1xjj7_46",ze={virtualizedTable:ye},Oe=({rowCount:e,rowComponent:t,rowHeight:s=48,height:n=600,className:r="",onVisibleRowsChange:i,overscanCount:o=20})=>{const d=a=>h.jsx(t,{...a});return h.jsx("div",{className:G(ze.virtualizedTable,r),style:{height:n},children:h.jsx(Se,{rowComponent:d,rowCount:e,rowHeight:s,rowProps:{},overscanCount:o,onRowsRendered:({startIndex:a,stopIndex:c})=>{i&&i(a,c)},role:"presentation",style:{width:"100%",height:n}})})},se=(e,t)=>e.position===t.position&&e.top===t.top&&e.left===t.left&&e.width===t.width&&e.height===t.height,Re=()=>(e,t)=>{if(e.index!==t.index)return!1;const s=e.style,n=t.style;return se(s,n)},_e=(e,t)=>(e.displayName===void 0&&("$$typeof"in e&&e.$$typeof?.toString().includes("Memo")?Object.assign(e,{displayName:t}):e.displayName=t),e),Ee="_row_1exr5_46",je="_dataCard_1exr5_56",We="_dataCardSelected_1exr5_98",ke="_dataCardEntered_1exr5_104",Te="_dataCardOne_1exr5_109",Me="_dataCardZero_1exr5_120",O={row:Ee,dataCard:je,dataCardSelected:We,dataCardEntered:ke,dataCardOne:Te,dataCardZero:Me},Ae=({items:e,style:t,gap:s=8,renderItem:n,rowIndex:r})=>{const[i,o]=u.useState(!1);if(u.useEffect(()=>{o(!0)},[]),!e?.length)return h.jsx("div",{className:G(O.row,i&&O.rowEntered),style:t});const a=(Number(t.height)||48)-s*2;return h.jsx("div",{className:G(O.row,i&&O.rowEntered),style:{...t,"--row-gap":`${s}px`,"--card-size":`${a}px`},children:e.map((c,l)=>h.jsx("div",{children:n(c)},l+r))})},re=u.memo(Ae,(e,t)=>e.rowIndex!==t.rowIndex||e.gap!==t.gap||e.items!==t.items||e.renderItem!==t.renderItem?!1:se(e.style,t.style));_e(re,"Row");const He=({value:e,onToggle:t,className:s})=>{const[n,r]=u.useState(!1),[i,o]=u.useState(!1);u.useEffect(()=>{o(!0)},[]);const d=u.useCallback(()=>{r(!0),t?.()},[t]),a=u.useCallback(c=>{(c.key==="Enter"||c.key===" ")&&d()},[d]);return ae(()=>{r(!1)},n?200:null),h.jsx("div",{className:G(O.dataCard,{[O.dataCardSelected]:n,[O.dataCardEntered]:i,[O.dataCardOne]:e===1,[O.dataCardZero]:e===0},s),role:"button",tabIndex:0,"aria-pressed":n,"data-role":"data-card",onClick:d,onKeyDown:a,children:e})},Ne=Object.freeze([]),X=e=>{let t;const s=new Set,n=(c,l)=>{const f=typeof c=="function"?c(t):c;if(!Object.is(f,t)){const x=t;t=l??(typeof f!="object"||f===null)?f:Object.assign({},t,f),s.forEach(p=>p(t,x))}},r=()=>t,d={setState:n,getState:r,getInitialState:()=>a,subscribe:c=>(s.add(c),()=>s.delete(c))},a=t=e(n,r,d);return d},Ve=(e=>e?X(e):X),De=e=>e;function $e(e,t=De){const s=Z.useSyncExternalStore(e.subscribe,Z.useCallback(()=>t(e.getState()),[e,t]),Z.useCallback(()=>t(e.getInitialState()),[e,t]));return Z.useDebugValue(s),s}const ee=e=>{const t=Ve(e),s=n=>$e(t,n);return Object.assign(s,t),s},Pe=(e=>e?ee(e):ee),Ge=e=>(t,s,n)=>{const r=n.subscribe;return n.subscribe=((o,d,a)=>{let c=o;if(d){const l=a?.equalityFn||Object.is;let f=o(n.getState());c=x=>{const p=o(x);if(!l(f,p)){const C=f;d(f=p,C)}},a?.fireImmediately&&d(f,f)}return r(c)}),e(t,s,n)},Be=Ge,W={GAP:8,ROW_HEIGHT:56};let N=null,V=null,H=null,$=0;const Le=1e4,Ye=()=>{if(typeof window>"u"||typeof Worker>"u")return null;try{return new Worker(new URL("/folio/assets/data-worker-EereTlug.js",import.meta.url),{type:"module"})}catch{return null}},F=Ye(),Ze=async e=>e===0?Promise.resolve():N&&V&&$===e||H&&$===e?H:($=e,N=null,V=null,H=null,F?(H=new Promise(t=>{const s=n=>{if(!n?.data||n.data.type!=="INIT_COMPLETE")return;const{entities:r,rows:i,itemsPerRow:o}=n.data.payload;o===$&&(N=r,V=i,F.removeEventListener("message",s),t())};F.addEventListener("message",s),F.postMessage({type:"INIT",payload:{itemsPerRow:e,totalItems:Le}})}),H):Promise.resolve()),D=Pe()(Be((e,t)=>{const s=async n=>{n!==0&&(await Ze(n),N&&V&&e({entities:N,rows:V,itemsPerRow:n}))};return{entities:N||{},rows:V||[],itemsPerRow:$,gap:W.GAP,toggleValue:n=>e(r=>{const i=r.entities[n];return i?{entities:{...r.entities,[n]:{value:i.value===0?1:0}}}:r}),setItemsPerRow:n=>{t().itemsPerRow!==n&&s(n)},getRowItemIds:n=>t().rows[n]||[],getEntityValue:n=>t().entities[n]?.value}})),ie=u.memo(({itemId:e})=>{const t=D(r=>r.entities[e]?.value),s=D(r=>r.toggleValue),n=u.useCallback(()=>{s(e)},[e,s]);return t===void 0?null:h.jsx(He,{value:t,onToggle:n})},(e,t)=>e.itemId===t.itemId);ie.displayName="DataRowItem";const Fe=u.memo(({index:e,style:t})=>{const n=D(r=>r.rows)[e]??Ne;return n?.length?h.jsx(re,{items:n,style:t,gap:W.GAP,renderItem:r=>h.jsx(ie,{itemId:r}),rowIndex:e}):h.jsx("div",{style:t})},Re()),Ue=e=>{},qe=({containerWidth:e})=>{if(e<=W.GAP)return 0;const s=W.ROW_HEIGHT-W.GAP*2+W.GAP,n=e-W.GAP;return Math.max(1,Math.floor(n/s))},Ke="_section_1ivd2_46",Je="_heading_1ivd2_56",Qe="_subheading_1ivd2_61",Xe="_loading_1ivd2_68",et="_dataContainer_1ivd2_72",tt="_headingWrapper_1ivd2_80",nt="_subheadingWrapper_1ivd2_87",M={section:Ke,heading:Je,subheading:Qe,loading:Xe,dataContainer:et,headingWrapper:tt,subheadingWrapper:nt},st=()=>{const e=u.useRef(null),t=u.useRef(null),s=oe(t,!0).width,n=u.useDeferredValue(s);ce(e,{threshold:0});const{screenHeight:r}=de(),i=r??600,o=D(l=>l.rows.length),d=D(l=>l.itemsPerRow),a=D(l=>l.setItemsPerRow);Ue({container:t.current}),u.useEffect(()=>{const l=qe({containerWidth:n});l&&l!==d&&a(l)},[n,d,a]);const c="data-intensive-heading";return h.jsxs("div",{className:M.section,ref:e,"aria-labelledby":c,children:[h.jsx("div",{className:M.headingWrapper,children:h.jsx(q,{id:c,variant:"h1",className:M.heading,children:"Data intensive"})}),h.jsx("div",{className:M.subheadingWrapper,children:h.jsxs(q,{variant:"subheading",className:M.subheading,color:"muted",children:[h.jsx(q,{as:"span",variant:"body",color:"primary",weight:"medium",children:"Issue:"})," ","Rendering ",o*d," data points"]})}),h.jsx(te,{children:h.jsx("div",{ref:t,className:M.dataContainer,children:o>0?h.jsx(Oe,{rowCount:o,rowComponent:Fe,rowHeight:W.ROW_HEIGHT,height:i*.55}):h.jsx("div",{className:M.loading,children:"Loading data..."})})})]})},it=u.memo(st);export{it as DataIntensiveWidget};
